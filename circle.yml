machine:
  java:
    version:
      oraclejdk8
  services:
    - postgresql
    - elasticsearch
    - docker
  environment:
    SINKIT_ACCESS_TOKEN: blablabla
    SINKIT_POSTGRESQL_DB_HOST: localhost
    SINKIT_POSTGRESQL_DB_PORT: 5432
    SINKIT_POSTGRESQL_PASS:  
    SINKIT_POSTGRESQL_USER: ubuntu
    SINKIT_JGROUPS_NETWORKING: jgroups-udp.xml
    SINKIT_POSTGRESQL_DB_NAME: circle_test
    SINKIT_SINKHOLE_IP: 46.101.144.163
    SINKIT_SINKHOLE_IPV6: ::1
    SINKIT_ELASTIC_HOST: localhost
    SINKIT_ELASTIC_PORT: 9200
dependencies:
  override:
    - git clone https://github.com/kdkanishka/Virustotal-Public-API-V2.0-Client.git && pushd Virustotal-Public-API-V2.0-Client/ && mvn install -DskipTests && popd
    - curl -XPUT localhost:9200/_template/iocs -d @integration-tests/src/test/resources/elastic_iocs.json
    - curl -XPUT localhost:9200/_template/logs -d @integration-tests/src/test/resources/elastic_logs.json
test:
  override:
    - mvn clean install -Parq-wildfly-managed
deployment:
  hub:
    branch: master
    commands:
      - docker info
      - docker build -t karm/sinkit-core .
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push karm/sinkit-core

